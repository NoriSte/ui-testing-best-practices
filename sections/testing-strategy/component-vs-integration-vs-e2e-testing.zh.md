# 组件测试 vs（UI）集成测试 vs E2E 测试

<!-- markdownlint-disable MD033 -->
<br/>

## 一段简要说明

在谈论 UI 测试时（请记住我们只谈论 UI，而不是底层 JavaScript 代码），有三种主要的测试类型：

- **组件测试**：UI 的单元测试，它们在隔离的环境中测试每个单独的组件。

  在隔离中开发组件很重要，因为它允许你将它们与相应的容器/用途隔离开来。组件存在是为了隔离单一的行为/内容（[单一职责原则](https://www.wikiwand.com/en/Single_responsibility_principle)），因此，在隔离中编码是有益的。

  有许多在隔离中开发组件的方法和工具，但由于其效果和生态系统，[Storybook](https://storybook.js.org) 成为了标准选择。最新的 Storybook 版本包含了优秀的 [Vitest 浏览器模式](https://vitest.dev/guide/browser/)，这是单独测试 UI 组件的最快方法。

  组件有三种类型的契约：暴露的数据（**HTML**）、其可视化部分（**CSS**）以及外部 API（**props 和回调**）。测试每个方面可能非常繁琐，这时 [Storybook](https://storybook.js.org/) 就派上用场了。它允许您自动化：
- **a11y（可访问性）测试**：HTML 有不同的用途，例如 SEO 和 a11y，而测试 HTML 的可访问性是确保 HTML 语义正确并与屏幕阅读器保持高兼容性的最彻底方法。因此，SEO 也受益匪浅。
- **视觉回归测试**：将组件的视觉效果与之前的组件进行**逐像素**的比较，再次提示您选择是否接受更改。
- **回调测试**：一个小型 React 容器应用渲染组件并传递一些回调。然后，模拟用户交互并传递预期会被调用的回调。 [React 测试库](https://testing-library.com/docs/react-testing-library/) 是此类测试的标准库。
- **交互测试**：某些与组件的交互需要正确的状态管理。此类测试必须从用户角度编写，而不是从内部角度编写（例如，用户填写输入字段时的值，而不是内部组件的状态）。交互/状态测试应该在键盘事件触发后断言输入字段的值。
- **回调测试**：当组件接受回调以通知父组件某些更新时，务必测试所有回调是否被正确调用。

或者，Cypress 推出了自己的解决方案，以便在其中启动组件测试，请查看 [使用 Cypress 进行 React 组件单元测试](../tools/cypress-react-component-test.zh.md) 章节。

- **UI 集成测试**：它们在真实浏览器中运行整个应用 **而不连接真实服务器**。这些测试是每个前端开发人员的王牌。它们运行速度快，不容易出现随机失败或假阴性。

  前端应用程序并不知道没有真实服务器：每个 AJAX 调用都会被测试工具在瞬间解决。静态 JSON 响应（称为“fixtures”）用于模拟服务器响应。Fixtures 允许我们测试前端状态，模拟每种可能的后端状态。

  另一个有趣的效果是：Fixtures **允许你在没有工作的后端** 应用程序的情况下工作。你可以将 UI 集成测试视为“仅前端”测试。

  在最成功的测试套件的核心，有很多 UI 集成测试，考虑到对前端应用程序的最佳测试类型。

- **端到端（E2E）测试**：它们与真实服务器进行交互，运行整个应用程序。从用户交互（其中之一是“端”）到业务数据（另一个“端”）：一切都必须按设计工作。E2E 测试通常很慢，因为
  - 它们需要一个 **工作的后端** 应用程序，通常在前端应用程序旁边启动。没有服务器，你不能启动它们，所以你依赖于后端开发人员的工作
  - 它们需要 **可靠的数据**，在每次测试之前进行种植和清理

  这就是为什么 E2E 测试不可行作为唯一/主要测试类型的原因。它们非常重要，因为它们测试所有内容（前端 + 后端），但必须小心使用，以避免脆弱且持续时间长的测试套件。

  在具有许多 UI 集成测试的完整套件中，你可以将 E2E 测试视为“后端测试”。通过它们，你应该测试哪些流程？
  - 快乐路径流程：你需要确保至少用户能够完成基本操作
  - 对你的业务有价值

  在具有许多 UI 集成测试的完整套件中，你可以将 E2E 测试视为“后端测试”。通过它们，你应该测试哪些流程？
  - 快乐路径流程：你需要确保至少用户能够完成基本操作
  - 对你的业务有价值的一切：无论是快乐路径还是其他，都要测试你的业务关心的任何内容（明显是优先考虑它们）
  - 经常中断的一切：系统的薄弱区域也必须受到监视

识别/定义测试类型对于对它们进行分组、[合理命名测试文件](/sections/generic-best-practices/name-test-files-wisely.zh.md)、限制它们的

范围以及选择是否在整个应用程序和部署流水线中运行它们很有用。

<!-- markdownlint-disable MD033 -->
<br /><br />

*由[NoriSte](https://github.com/NoriSte)在[dev.to](https://dev.to/noriste/component-vs-ui-integration-vs-e2e-tests-3i0d)和[Medium](https://medium.com/@NoriSte/component-vs-ui-integration-vs-e2e-tests-f02b575339dc)上进行了联合发表。*
